<html lang="th">
<head>
    <base target="_top">
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ITD PRMGGROUP</title>
    <link rel="icon" type="image/png" href="https://img5.pic.in.th/file/secure-sv1/5529681.jpg">
    
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Font Awesome CDN -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Sarabun Font from Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <style>
        body {
            font-family: 'Sarabun', sans-serif;
        }
    </style>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // URL ของเว็บแอป
            const web_app_url = 'https://script.google.com/macros/s/AKfycbySHO5I0y-XbznETCHqR9b1SUxCa55acRTJQRL50k-85CiD1qX6sI9wOT3D6ao44_iKgQ/exec';

            // ฟังก์ชันตรวจสอบ In-App Browser
            function is_InAppBrowser() {
                const userAgent = navigator.userAgent || navigator.vendor || window.opera;
                return (
                    /FBAV|FBAN|LINE|Tiktok|Instagram|Twitter|Snapchat|Telegram|MicroMessenger|Pinterest|Reddit|Threads/i.test(userAgent) || 
                    (
                        /CriOS/.test(userAgent) && /Safari/.test(userAgent)
                    )
                );
            }

            // กำหนด src ของ iframe
            document.getElementById('mainIframe').src = web_app_url;
            
            const urlParams = new URLSearchParams(window.location.search);
            
            if (urlParams.has('openExternalBrowser')) {
                console.log("เปิดในเบราว์เซอร์ภายนอกแล้ว");
                return;
            }

            if (is_InAppBrowser()) {
                const modal = document.getElementById('inAppBrowserModal');
                const confirmButton = document.getElementById('confirmButton');
                const copyLinkButton = document.getElementById('copyLinkButton');
                const copyMessage = document.getElementById('copyMessage');

                // URL ที่จะ redirect (เพิ่มพารามิเตอร์ openExternalBrowser)
                const urlToRedirect = new URL(window.location.href);
                urlToRedirect.searchParams.set('openExternalBrowser', '1');
                const finalUrl = urlToRedirect.toString();

                // แสดง Modal
                modal.classList.remove('hidden');
                
                // ปุ่ม "เปิดเบราว์เซอร์"
                // confirmButton.addEventListener('click', () => {
                //     const ua = navigator.userAgent.toLowerCase();

                //     if (/android/i.test(ua)) {
                //         // ✅ Android → เปิด Chrome ด้วย intent:// และ fallback
                //         window.location.href =
                //           "intent://" + finalUrl.replace(/^https?:\/\//, "") +
                //           "#Intent;scheme=https;package=com.android.chrome;S.browser_fallback_url=" +
                //           encodeURIComponent(finalUrl) + ";end";
                //     } else if (/iphone|ipad|ipod/i.test(ua)) {
                //         // ✅ iOS → เปิด Safari โดยตรง
                //         window.location.href = finalUrl;
                //     } else {
                //         // ✅ Desktop หรือเบราว์เซอร์ปกติ
                //         window.location.href = finalUrl;
                //     }
                // });
confirmButton.addEventListener('click', () => {
    const webAppUrl = "https://script.google.com/macros/s/AKfycbySHO5I0y-XbznETCHqR9b1SUxCa55acRTJQRL50k-85CiD1qX6sI9wOT3D6ao44_iKgQ/exec";
    const ua = navigator.userAgent.toLowerCase();

    if (/android/i.test(ua)) {
        // Android → Chrome
        window.location.href =
          "intent://" + webAppUrl.replace(/^https?:\/\//, "") +
          "#Intent;scheme=https;package=com.android.chrome;S.browser_fallback_url=" +
          encodeURIComponent(webAppUrl) + ";end";
    } else if (/iphone|ipad|ipod/i.test(ua)) {
        // iOS → Safari
        window.location.href = webAppUrl;
    } else {
        // Desktop → ปกติ
        window.location.href = webAppUrl;
    }
});
                // ปุ่ม "คัดลอกลิงก์"
                copyLinkButton.addEventListener('click', async () => {
                    try {
                        await navigator.clipboard.writeText(finalUrl);
                        copyMessage.classList.remove('hidden');
                        setTimeout(() => {
                            copyMessage.classList.add('hidden');
                        }, 2000);
                    } catch (err) {
                        console.error('Failed to copy text: ', err);
                    }
                });
            }
        });
    </script>
</head>
<body>
    <!-- Modal สำหรับแจ้งเตือน In-App Browser -->
    <div id="inAppBrowserModal" class="fixed inset-0 bg-gray-900 bg-opacity-75 z-50 flex items-center justify-center p-4 hidden">
        <div class="bg-white rounded-none sm:rounded-lg shadow-none sm:shadow-xl w-full h-full sm:max-w-sm sm:h-auto p-6 flex flex-col justify-between text-center">
            <div>
                <div class="flex flex-col items-center justify-center mb-6">
                    <i class="fa-solid fa-heart text-red-500 text-5xl mb-4"></i>
                </div>
                
                <h2 class="text-2xl font-bold text-gray-800 mb-2">เปิดในเบราว์เซอร์หลัก</h2>
                <p class="text-gray-600 mb-6 text-sm">เพื่อประสิทธิภาพสูงสุดในการใช้งาน กรุณาเปิดหน้าเว็บนี้ในเบราว์เซอร์หลัก (เช่น Chrome, Safari) ค่ะ</p>
                
                <div class="text-left text-sm text-gray-700 mt-4 space-y-2">
                    <p><b>คำแนะนำ:</b></p>
                    <p>• หากเปิดลิงก์นี้ด้วย Facebook และแอปพลิเคชันอื่นๆ: กรุณากดปุ่ม "คัดลอกลิงก์" เพื่อนำไปวางบนเบราว์เซอร์หลัก</p>
                    <p>• หากเปิดผ่าน LINE: กดปุ่ม "เปิดเบราว์เซอร์" ได้เลยค่ะ</p>
                </div>
            </div>
            
            <div class="flex flex-col items-center mt-auto">
                <div class="flex justify-center space-x-4 mb-4">
                    <button id="confirmButton" class="px-6 py-2 rounded-lg text-sm font-semibold text-white bg-red-600 hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-red-500 focus:ring-opacity-75 transition-colors duration-200">
                        เปิดเบราว์เซอร์
                    </button>
                    <button id="copyLinkButton" class="px-6 py-2 rounded-lg text-sm font-semibold text-gray-800 bg-gray-200 hover:bg-gray-300 focus:outline-none focus:ring-2 focus:ring-gray-400 focus:ring-opacity-75 transition-colors duration-200">
                        คัดลอกลิงก์
                    </button>
                </div>
                <span id="copyMessage" class="text-green-600 text-sm font-medium hidden">คัดลอกแล้ว!</span>
            </div>
        </div>
    </div>

    <!-- ส่วนของ iframe -->
    <iframe id="mainIframe" style="width: 100%; height: 100vh;" scrolling="yes" src="" frameborder="0"></iframe>
</body>
</html>


