<body>
    <!-- Modal สำหรับแจ้งเตือน In-App Browser -->
    <div id="inAppBrowserModal" class="fixed inset-0 bg-gray-900 bg-opacity-75 z-50 flex items-center justify-center p-4 hidden">
        <div class="bg-white rounded-lg shadow-xl w-full sm:max-w-sm p-6 flex flex-col text-center">
            <div class="flex flex-col items-center mb-6">
                <i class="fa-solid fa-globe text-blue-500 text-5xl mb-4"></i>
                <h2 class="text-2xl font-bold text-gray-800 mb-2">เปิดในเบราว์เซอร์หลัก</h2>
                <p class="text-gray-600 mb-6 text-sm">
                    เพื่อการใช้งานที่สมบูรณ์ กรุณาเปิดลิงก์นี้บน Chrome หรือ Safari
                </p>
            </div>
            <div class="flex justify-center space-x-4">
                <button id="confirmButton" class="px-6 py-2 rounded-lg text-sm font-semibold text-white bg-blue-600 hover:bg-blue-700">
                    เปิดเบราว์เซอร์
                </button>
                <button id="copyLinkButton" class="px-6 py-2 rounded-lg text-sm font-semibold text-gray-800 bg-gray-200 hover:bg-gray-300">
                    คัดลอกลิงก์
                </button>
            </div>
            <span id="copyMessage" class="text-green-600 text-sm font-medium hidden mt-3">คัดลอกแล้ว!</span>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const webAppUrl = "https://script.google.com/macros/s/AKfycby0z-b3qP8WRNZDlUFYInUIuJIDQs6dkA1J5KyClP_GqwoXLcY7932xVcUGu5nkwaEI7A/exec";

            function is_InAppBrowser() {
                const ua = navigator.userAgent || "";
                return /FBAV|FBAN|LINE|Tiktok|Instagram|Twitter|Snapchat|Telegram|MicroMessenger|Pinterest|Reddit|Threads/i.test(ua);
            }

            if (is_InAppBrowser()) {
                document.getElementById('inAppBrowserModal').classList.remove('hidden');
            } else {
                // ถ้าไม่ใช่ in-app browser → เปิด web app โดยตรงเลย
                window.location.href = webAppUrl;
            }

            // ปุ่มเปิดเบราว์เซอร์
            document.getElementById('confirmButton').addEventListener('click', () => {
                const ua = navigator.userAgent.toLowerCase();
                if (/android/i.test(ua)) {
                    window.location.href =
                      "intent://" + webAppUrl.replace(/^https?:\/\//, "") +
                      "#Intent;scheme=https;package=com.android.chrome;S.browser_fallback_url=" +
                      encodeURIComponent(webAppUrl) + ";end";
                } else {
                    window.location.href = webAppUrl; // iOS & Windows
                }
            });

            // ปุ่มคัดลอกลิงก์
            document.getElementById('copyLinkButton').addEventListener('click', async () => {
                try {
                    await navigator.clipboard.writeText(webAppUrl);
                    const msg = document.getElementById('copyMessage');
                    msg.classList.remove('hidden');
                    setTimeout(() => msg.classList.add('hidden'), 2000);
                } catch (err) {
                    console.error("Copy failed:", err);
                }
            });
        });
    </script>
</body>
